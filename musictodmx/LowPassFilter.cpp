#include "LowPassFilter.h"

static double filter_taps[LOWPASSFILTER_TAP_NUM] = {
   -0.002900152789029534,
  -0.01725150958804664,
  -0.025237737878310726,
  -0.03450887265986564,
  -0.035769420321297145,
  -0.02707193891868683,
  -0.009266288265014268,
  0.011853017966072243,
  0.027501097957205393,
  0.029565585486533916,
  0.014871124981712943,
  -0.01197827612665861,
  -0.038982071507521386,
  -0.050731517606409995,
  -0.03469825273055899,
  0.012709836136457346,
  0.08319599421145894,
  0.1583131270392645,
  0.2156538553083616,
  0.23708501839999613,
  0.2156538553083616,
  0.1583131270392645,
  0.08319599421145894,
  0.012709836136457346,
  -0.03469825273055899,
  -0.050731517606409995,
  -0.038982071507521386,
  -0.01197827612665861,
  0.014871124981712943,
  0.029565585486533916,
  0.027501097957205393,
  0.011853017966072243,
  -0.009266288265014268,
  -0.02707193891868683,
  -0.035769420321297145,
  -0.03450887265986564,
  -0.025237737878310726,
  -0.01725150958804664,
  -0.002900152789029534
};

void LowPassFilter_init(LowPassFilter* f) {
  int i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void LowPassFilter_put(LowPassFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LOWPASSFILTER_TAP_NUM)
    f->last_index = 0;
}

double LowPassFilter_get(LowPassFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LOWPASSFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
