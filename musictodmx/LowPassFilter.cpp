#include "LowPassFilter.h"

static double filter_taps[LOWPASSFILTER_TAP_NUM] = {
  0.005337528152808051,
  0.0007849468232066216,
  0.0007773610309696767,
  0.0007204833752943913,
  0.0006084005810105116,
  0.0004357867664043076,
  0.00019856448954052843,
  -0.0001066681709109323,
  -0.00048263499203428834,
  -0.0009293791238806241,
  -0.001446977676890411,
  -0.0020331055125126433,
  -0.0026835427579218287,
  -0.0033922353418392773,
  -0.004150941680341578,
  -0.004949461416246604,
  -0.005776115424928463,
  -0.00661747484893005,
  -0.007459090910324934,
  -0.008282337641019908,
  -0.009071449704058657,
  -0.009804492867739843,
  -0.010462153113906214,
  -0.011026054724183856,
  -0.011476160217402673,
  -0.011790357611200232,
  -0.011947855807818878,
  -0.011937055206931444,
  -0.011735559335882287,
  -0.011332188299532631,
  -0.010713667486399608,
  -0.00987070772527611,
  -0.008796933507537574,
  -0.007489592359094801,
  -0.005949331518168184,
  -0.0041799109494927095,
  -0.0021893159326025965,
  0.000010760403202417028,
  0.0024051915337273996,
  0.004974220568177907,
  0.007695516910011845,
  0.010543609130140599,
  0.013489958066956041,
  0.01650389248876035,
  0.019549813288097247,
  0.022604970596664095,
  0.02560779978487537,
  0.028548462435337874,
  0.03138304656799075,
  0.03407125448789697,
  0.0365786724665364,
  0.03887510758615699,
  0.04093199269018339,
  0.04272155196429118,
  0.04422105768408318,
  0.04540893119389852,
  0.046269103811307236,
  0.04678987275092368,
  0.046964250136043086,
  0.04678987275092368,
  0.046269103811307236,
  0.04540893119389852,
  0.04422105768408318,
  0.04272155196429118,
  0.04093199269018339,
  0.03887510758615699,
  0.0365786724665364,
  0.03407125448789697,
  0.03138304656799075,
  0.028548462435337874,
  0.02560779978487537,
  0.022604970596664095,
  0.019549813288097247,
  0.01650389248876035,
  0.013489958066956041,
  0.010543609130140599,
  0.007695516910011845,
  0.004974220568177907,
  0.0024051915337273996,
  0.000010760403202417028,
  -0.0021893159326025965,
  -0.0041799109494927095,
  -0.005949331518168184,
  -0.007489592359094801,
  -0.008796933507537574,
  -0.00987070772527611,
  -0.010713667486399608,
  -0.011332188299532631,
  -0.011735559335882287,
  -0.011937055206931444,
  -0.011947855807818878,
  -0.011790357611200232,
  -0.011476160217402673,
  -0.011026054724183856,
  -0.010462153113906214,
  -0.009804492867739843,
  -0.009071449704058657,
  -0.008282337641019908,
  -0.007459090910324934,
  -0.00661747484893005,
  -0.005776115424928463,
  -0.004949461416246604,
  -0.004150941680341578,
  -0.0033922353418392773,
  -0.0026835427579218287,
  -0.0020331055125126433,
  -0.001446977676890411,
  -0.0009293791238806241,
  -0.00048263499203428834,
  -0.0001066681709109323,
  0.00019856448954052843,
  0.0004357867664043076,
  0.0006084005810105116,
  0.0007204833752943913,
  0.0007773610309696767,
  0.0007849468232066216,
  0.005337528152808051
};

void LowPassFilter_init(LowPassFilter* f) {
  int i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void LowPassFilter_put(LowPassFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LOWPASSFILTER_TAP_NUM)
    f->last_index = 0;
}

double LowPassFilter_get(LowPassFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LOWPASSFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
