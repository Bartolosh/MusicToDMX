#include "LowPassFilter.h"

static double filter_taps[LOWPASSFILTER_TAP_NUM] = {
  -0.004958642481345832,
  0.00011943339122208539,
  0.0010553694058051191,
  0.0026117215894381897,
  0.00476684446100596,
  0.007390568512742056,
  0.010320459202606148,
  0.01331536708594164,
  0.01607012337733989,
  0.018260476978215343,
  0.01956013691233001,
  0.019680266517600072,
  0.018416340023771776,
  0.015674592212494193,
  0.01150248526722144,
  0.006109235199686218,
  -0.00013771034433107364,
  -0.006725280598325264,
  -0.013026265007550138,
  -0.01835141126866237,
  -0.02200701674992825,
  -0.023360904542872894,
  -0.02191034459974447,
  -0.01733867377667462,
  -0.00956160842835147,
  0.001244511247605898,
  0.014640137591790553,
  0.02994175036152811,
  0.04626575092454695,
  0.06259476747389622,
  0.07785646417653153,
  0.09101145672651179,
  0.10114133304807063,
  0.10752598767951764,
  0.10970660821897278,
  0.10752598767951764,
  0.10114133304807063,
  0.09101145672651179,
  0.07785646417653153,
  0.06259476747389622,
  0.04626575092454695,
  0.02994175036152811,
  0.014640137591790553,
  0.001244511247605898,
  -0.00956160842835147,
  -0.01733867377667462,
  -0.02191034459974447,
  -0.023360904542872894,
  -0.02200701674992825,
  -0.01835141126866237,
  -0.013026265007550138,
  -0.006725280598325264,
  -0.00013771034433107364,
  0.006109235199686218,
  0.01150248526722144,
  0.015674592212494193,
  0.018416340023771776,
  0.019680266517600072,
  0.01956013691233001,
  0.018260476978215343,
  0.01607012337733989,
  0.01331536708594164,
  0.010320459202606148,
  0.007390568512742056,
  0.00476684446100596,
  0.0026117215894381897,
  0.0010553694058051191,
  0.00011943339122208539,
  -0.004958642481345832
};

void LowPassFilter_init(LowPassFilter* f) {
  int i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void LowPassFilter_put(LowPassFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LOWPASSFILTER_TAP_NUM)
    f->last_index = 0;
}

double LowPassFilter_get(LowPassFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LOWPASSFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
