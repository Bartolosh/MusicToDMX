#include "LowPassFilter.h"

static double filter_taps[LOWPASSFILTER_TAP_NUM] = {
  -0.004546528053599695,
  0.0011985467698760095,
  0.00226950596012788,
  0.004001082252621803,
  0.0062851166896956785,
  0.008949297651006074,
  0.011811435057186355,
  0.01459513350783393,
  0.017010224730871933,
  0.018751617093029777,
  0.01952184697803819,
  0.01908669827828898,
  0.017288163750899466,
  0.014087423671355636,
  0.009585810994358783,
  0.0040281304882137355,
  -0.002191479074461296,
  -0.008557025399811813,
  -0.01446180339670614,
  -0.019253614130130846,
  -0.022295389260922,
  -0.023020198604377793,
  -0.020993016315653222,
  -0.015961507085632543,
  -0.007892443540199608,
  0.0030047036972686526,
  0.01628024568088101,
  0.0312650624925713,
  0.04711315872610042,
  0.06286360077124468,
  0.0775124211162991,
  0.09009328999543742,
  0.099755785150108,
  0.10583558559779586,
  0.10791049794783286,
  0.10583558559779586,
  0.099755785150108,
  0.09009328999543742,
  0.0775124211162991,
  0.06286360077124468,
  0.04711315872610042,
  0.0312650624925713,
  0.01628024568088101,
  0.0030047036972686526,
  -0.007892443540199608,
  -0.015961507085632543,
  -0.020993016315653222,
  -0.023020198604377793,
  -0.022295389260922,
  -0.019253614130130846,
  -0.01446180339670614,
  -0.008557025399811813,
  -0.002191479074461296,
  0.0040281304882137355,
  0.009585810994358783,
  0.014087423671355636,
  0.017288163750899466,
  0.01908669827828898,
  0.01952184697803819,
  0.018751617093029777,
  0.017010224730871933,
  0.01459513350783393,
  0.011811435057186355,
  0.008949297651006074,
  0.0062851166896956785,
  0.004001082252621803,
  0.00226950596012788,
  0.0011985467698760095,
  -0.004546528053599695
};

void LowPassFilter_init(LowPassFilter* f) {
  int i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void LowPassFilter_put(LowPassFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LOWPASSFILTER_TAP_NUM)
    f->last_index = 0;
}

double LowPassFilter_get(LowPassFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LOWPASSFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
